<html>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<body>
<h1>Intégrer NosDeputes.fr sur votre site</h1>
<script type="text/javascript" src="/js/jquery-1.6.2.min.js"></script>
<div id="editor">
<form>
<h2>Saisissez le nom de votre député</h2>
<p>Nom du député : <input type="text" id="nom" class="update"><input type="button" value="créer" id="bouton"/></p>
<h2>Choisissez quelques options</h2>
<p><label><input type="checkbox" id="titre" value="1" class="update" CHECKED>Inserrer un titre</label></p>
<p><label><input type="checkbox" id="tag" value="1" class="update">Inserrer un nuage de tags</label></p>
<p><label><input type="checkbox" id="graph" value="1" class="update" CHECKED>Inserrer le graphique d'activité</label></p>
<p><label><input type="checkbox" id="photo" value="1" class="update" CHECKED>Inserrer la photo du député-e</label></p>
<p><label><input type="checkbox" id="indicateurs" value="1" class="update"CHECKED>Inserrer les indicateurs d'activité</label></p>
<p>Taille du widget : <input type="text" id="width" class="update" value="600"/></p>
<input type="hidden" id="height" value=""/>
<input type="hidden" id="url" value=""/>
</form>
</div>
<h2>Prévisualiser le résultat</h2>
<div id="resultat">
</div>
<h2>Embarquez votre député</h2>
<p>Pour insérer ce widget sur votre site, il vous suffit de copier/coller le contenu HTML ci dessous :</p>
<textarea cols="150" rows=3 id="iframe" onclick="this.focus();this.select()" readonly="readonly">
</textarea>
<script>
var updateIframe = function() {
  $('#height').val($('#resultat').height());
  $("#iframe").val('<iframe src="'+$('#url').val()+'" height="'+$('#height').val()+'" width="'+$('#width').val()+'"/>');
}
var updatePreview = function() {
   var nom = $('#nom').val();
   if (!nom) return;
   var url = 'http://'+window.location.hostname+'/widget/'+nom.replace(/ /, '-')+"?iframe=true&";
   if (!$("#titre:checked").val()) {
     url += "notitre=1&"; 
   }
   if (!$("#tag:checked").val()) {
     url += "notags=1&"; 
   }
   if (!$("#graph:checked").val()) {
     url += "nographe=1&"; 
   }
   if (!$("#photo:checked").val()) {
     url += "nophoto=1&"; 
   }
   if (!$("#indicateurs:checked").val()) {
     url += "noactivite=1&"; 
   }
   url+= "width="+$('#width').val();
   $('#url').val(url);
   updateIframe();
   $('#resultat').load(url, function(text, status) {
     updateIframe();
   });
};
$('.update').change(updatePreview);
$('#bouton').click(updatePreview);
$("#height").change(updateIframe);
</script>
